-- Reset DB
DROP DATABASE IF EXISTS airbnbmanagement;
CREATE DATABASE airbnbmanagement;
USE airbnbmanagement;

-- Drop tables in FK-safe order
DROP TABLE IF EXISTS RENTS;
DROP TABLE IF EXISTS RENTERPHONENUM;
DROP TABLE IF EXISTS RENTER;
DROP TABLE IF EXISTS FIXES;
DROP TABLE IF EXISTS CONTRACTOR;
DROP TABLE IF EXISTS OWNED;
DROP TABLE IF EXISTS MANAGED;
DROP TABLE IF EXISTS UNIT;
DROP TABLE IF EXISTS CLEANER;
DROP TABLE IF EXISTS OWNER;

-- OWNER
CREATE TABLE OWNER (
  OWNERID VARCHAR(3),
  CONSTRAINT OWNER_PK PRIMARY KEY (OWNERID)
);

INSERT INTO OWNER (OWNERID) VALUES ('001');
INSERT INTO OWNER (OWNERID) VALUES ('002');
INSERT INTO OWNER (OWNERID) VALUES ('003');

-- CLEANER (self-referencing trainer)
CREATE TABLE CLEANER (
  CLEANERID VARCHAR(3),
  HIREDATE DATE,
  TRAINERID VARCHAR(3),
  CONSTRAINT CLEANER_PK PRIMARY KEY (CLEANERID),
  CONSTRAINT CLEANER_FK_TRAINER FOREIGN KEY (TRAINERID)
    REFERENCES CLEANER(CLEANERID)
);

INSERT INTO CLEANER (CleanerID, HireDate, TrainerID) VALUES ('201', '2022-06-27', NULL);
INSERT INTO CLEANER (CleanerID, HireDate, TrainerID) VALUES ('302', '2023-10-20', '201');
INSERT INTO CLEANER (CleanerID, HireDate, TrainerID) VALUES ('405', '2022-11-12', '201');
INSERT INTO CLEANER (CleanerID, HireDate, TrainerID) VALUES ('506', '2023-05-17', '201');

-- UNIT (cleaner assigned)
CREATE TABLE UNIT (
  UNITID VARCHAR(3),
  NUMBATH DECIMAL(3,1),
  NUMBED INT,
  RATING DECIMAL(3,2),
  MAXGUESTS INT,
  STREET VARCHAR(30),
  ZIP VARCHAR(30),
  CITY VARCHAR(30),
  STATE VARCHAR(30),
  CLEANERID VARCHAR(3),
  CONSTRAINT UNIT_PK PRIMARY KEY (UNITID),
  CONSTRAINT UNIT_FK_CLEANER FOREIGN KEY (CLEANERID)
    REFERENCES CLEANER(CLEANERID)
);

INSERT INTO UNIT(UNITID, NUMBATH, NUMBED, RATING, MAXGUESTS, STREET, ZIP, CITY, STATE, CLEANERID) VALUES
('101', 3.0, 5, 8.40, 7, '1289 Larimer', '80302', 'Boulder', 'Colorado', '201'),
('102', 1.5, 2, 9.20, 3, '743 Allen Street', '90210', 'Southpark', 'Ohio', '405'),
('103', 4.0, 5, 8.70, 8, '14 Old Harris Road', '03454', 'Harrisville', 'New Hampshire', '201'),
('104', 2.0, 3, 6.50, 4, '26 Cross Way', '80302', 'Boston', 'Massachusetts', '506'),
('105', 2.0, 2, 7.70, 6, '120 Euclid Ave', '80309', 'Boulder', 'Colorado', '302'),
('106', 1.0, 1, 9.30, 2, '813 W University Ave', '86001', 'Flagstaff', 'Arizona', '405'),
('107', 1.5, 3, 8.80, 5, '200 Summit Blvd', '80021', 'Broomfield', 'Colorado', '405'),
('108', 2.0, 2, 4.30, 5, '41 Camino Mariquita', '87508', 'Santa Fe', 'New Mexico', '201');

-- MANAGED: which units are managed for which owner
CREATE TABLE MANAGED (
  UNITID VARCHAR(3),
  OWNERID VARCHAR(3),
  BOOKINGFEE DECIMAL(20,2),
  MANAGESTARTDATE DATE,
  CONSTRAINT MANAGED_PK PRIMARY KEY (UNITID),
  CONSTRAINT MANAGED_FK_UNIT FOREIGN KEY (UNITID)
    REFERENCES UNIT(UNITID),
  CONSTRAINT MANAGED_FK_OWNER FOREIGN KEY (OWNERID)
    REFERENCES OWNER(OWNERID)
);

INSERT INTO MANAGED (UNITID, OWNERID, BOOKINGFEE, MANAGESTARTDATE) VALUES
('101', '001', 200.00, '2000-01-01'),
('102', '002', 100.00, '1990-11-11'),
('105', '003', 250.00, '1999-07-23');

-- OWNED: relationship between OWNER and UNIT (units not in MANAGED)
CREATE TABLE OWNED (
  UNITID VARCHAR(3),
  CONSTRAINT OWNED_PK PRIMARY KEY (UNITID),
  CONSTRAINT OWNED_FK_UNIT FOREIGN KEY (UNITID)
    REFERENCES UNIT(UNITID)
);

INSERT INTO OWNED (UNITID) VALUES ('103');
INSERT INTO OWNED (UNITID) VALUES ('104');
INSERT INTO OWNED (UNITID) VALUES ('106');
INSERT INTO OWNED (UNITID) VALUES ('107');
INSERT INTO OWNED (UNITID) VALUES ('108');

-- CONTRACTOR
CREATE TABLE CONTRACTOR (
  CONTRACTORID VARCHAR(3),
  CONTRACTORNAME VARCHAR(50),
  CONSTRAINT CONTRACTOR_PK PRIMARY KEY (CONTRACTORID)
);

INSERT INTO CONTRACTOR (CONTRACTORID, CONTRACTORNAME) VALUES
('101', 'Big Bob Contractors'),
('102', 'Little Robert Contractors'),
('103', 'Medium Rob Contractors');

-- FIXES: which contractor did work on which unit, when, and for how much
CREATE TABLE FIXES (
  CONTRACTORID VARCHAR(3),
  UNITID VARCHAR(3),
  FIXDATE DATE,
  PAYMENTAMOUNT DECIMAL(20,2),
  CONSTRAINT FIXES_PK PRIMARY KEY (CONTRACTORID, UNITID, FIXDATE),
  CONSTRAINT FIXES_FK_UNIT FOREIGN KEY (UNITID)
    REFERENCES UNIT(UNITID),
  CONSTRAINT FIXES_FK_CONTRACTOR FOREIGN KEY (CONTRACTORID)
    REFERENCES CONTRACTOR(CONTRACTORID)
);

INSERT INTO FIXES (CONTRACTORID, UNITID, FIXDATE, PAYMENTAMOUNT) VALUES
('101', '107', '2025-05-24', 150.00),
('101', '103', '2025-12-22', 100.00),
('103', '105', '2025-08-21', 350.00);

-- RENTER
CREATE TABLE RENTER (
  RENTERID VARCHAR(3),
  FIRSTNAME VARCHAR(50),
  LASTNAME VARCHAR(50),
  CONSTRAINT RENTER_PK PRIMARY KEY (RENTERID)
);

INSERT INTO RENTER (RENTERID, FIRSTNAME, LASTNAME) VALUES
('111', 'Ava', 'Thompson'),
('222', 'Liam', 'Rodriguez'),
('333', 'Sofia', 'Patel'),
('444', 'Ethan', 'Nguyen'),
('555', 'Chloe', 'Martinez'),
('666', 'Noah', 'Kim'),
('777', 'Isabella', 'Wright'),
('888', 'Mason', 'Rivera'),
('999', 'Olivia', 'Smith'),
('000', 'James', 'Anderson');

-- RENTERPHONENUM: allow multiple phone numbers per renter
CREATE TABLE RENTERPHONENUM (
  RENTERID VARCHAR(3),
  PHONENUM VARCHAR(15),
  CONSTRAINT RENTERPHONENUM_PK PRIMARY KEY (RENTERID, PHONENUM),
  CONSTRAINT RENTERPHONENUM_FK_RENTER FOREIGN KEY (RENTERID)
    REFERENCES RENTER(RENTERID)
);

INSERT INTO RENTERPHONENUM (PHONENUM, RENTERID) VALUES
('303-555-0181', '111'),
('720-555-2374', '222'),
('415-555-7920', '333'),
('646-555-3348', '444'),
('213-555-4816', '555'),
('408-555-9021', '666'),
('512-555-6637', '777'),
('702-555-1789', '888'),
('617-555-4205', '999'),
('801-555-5324', '000');

-- RENTS: bookings (one renter, one unit, date range)
CREATE TABLE RENTS (
  UNITID VARCHAR(3),
  RENTERID VARCHAR(3),
  BOOKINGDATE DATE,
  STARTDATE DATE,
  ENDDATE DATE,
  NUMGUESTS INT,
  CONSTRAINT RENTS_PK PRIMARY KEY (UNITID, RENTERID, STARTDATE),
  CONSTRAINT RENTS_FK_UNIT FOREIGN KEY (UNITID)
    REFERENCES UNIT(UNITID),
  CONSTRAINT RENTS_FK_RENTER FOREIGN KEY (RENTERID)
    REFERENCES RENTER(RENTERID)
);

INSERT INTO RENTS (UNITID, RENTERID, BOOKINGDATE, ENDDATE, STARTDATE, NUMGUESTS) VALUES
('101', '111', '2025-10-15', '2025-11-03', '2025-10-25', 2),
('102', '222', '2025-09-20', '2025-10-05', '2025-09-25', 4),
('102', '333', '2025-11-01', '2025-11-10', '2025-11-03', 1),
('104', '444', '2025-12-05', '2025-12-20', '2025-12-10', 3),
('105', '444', '2025-08-12', '2025-08-18', '2025-08-14', 5),
('101', '555', '2025-07-02', '2025-07-10', '2025-07-05', 2),
('106', '333', '2025-06-20', '2025-06-28', '2025-06-22', 4),
('107', '666', '2025-05-15', '2025-05-22', '2025-05-17', 3),
('105', '777', '2025-04-08', '2025-04-15', '2025-04-10', 2),
('108', '111', '2025-03-01', '2025-03-09', '2025-03-03', 1);

